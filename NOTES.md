"function" variable should not be used globally. Results in infinite loop.
Try to refrence other vars globally